<div class="page-container no-print">
  
  <header class="page-header">
    <div>
      <h1>Relat√≥rios & Laudos</h1>
      <p class="subtitle">Consulte fechamentos financeiros e emita laudos t√©cnicos</p>
    </div>
    <div class="date-filters">
      <select [ngModel]="selectedMonth()" (ngModelChange)="selectedMonth.set($event)">
        <option [value]="1">Janeiro</option>
        <option [value]="6">Junho</option>
        <option [value]="12">Dezembro</option>
        <!-- Adicione os outros meses -->
      </select>
      <select [ngModel]="selectedYear()" (ngModelChange)="selectedYear.set($event)">
        <option [value]="2024">2024</option>
        <option [value]="2025">2025</option>
      </select>
    </div>
  </header>

  <!-- CARDS DE RESUMO -->
  <div class="stats-row">
    <div class="card stat-card blue">
      <div class="stat-icon">üí∞</div>
      <div class="stat-data">
        <h3>{{ totalRevenue() | currency:'BRL' }}</h3>
        <p>Faturamento do M√™s</p>
      </div>
    </div>

    <div class="card stat-card green">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-data">
        <h3>{{ closedOrders().length }}</h3>
        <p>Servi√ßos Finalizados</p>
      </div>
    </div>

    <div class="card stat-card orange">
      <div class="stat-icon">üìà</div>
      <div class="stat-data">
        <h3>{{ averageTicket() | currency:'BRL' }}</h3>
        <p>Ticket M√©dio</p>
      </div>
    </div>
  </div>

  <!-- TABELA DE SERVI√áOS FECHADOS -->
  <div class="card table-container">
    <div class="card-header-simple">
      <h3>Hist√≥rico de Ordens de Servi√ßo</h3>
    </div>
    <table>
      <thead>
        <tr>
          <th>Data</th>
          <th>O.S. #</th>
          <th>Cliente / Ve√≠culo</th>
          <th>Servi√ßo Principal</th>
          <th>Valor</th>
          <th class="actions-col">Laudo</th>
        </tr>
      </thead>
      <tbody>
        @for (order of closedOrders(); track order.id) {
          <tr>
            <td>{{ order.date }}</td>
            <td><strong>#{{ order.id }}</strong></td>
            <td>
              <div class="col-group">
                <span class="primary-text">{{ order.client }}</span>
                <span class="secondary-text">{{ order.vehicle }}</span>
              </div>
            </td>
            <td>{{ order.serviceType }}</td>
            <td class="price-text">{{ order.total | currency:'BRL' }}</td>
            <td class="actions-cell">
              <button class="btn-action print" (click)="generateReport(order)" title="Gerar Laudo T√©cnico">
                üñ®Ô∏è
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>

<!-- MODAL DE LAUDO T√âCNICO (VISUALIZA√á√ÉO DE IMPRESS√ÉO) -->
@if (showModal()) {
  <div class="modal-overlay" (click)="closeModal()">
    <!-- A classe .print-area √© a √∫nica que aparecer√° na impress√£o -->
    <div class="report-paper print-area" (click)="$event.stopPropagation()">
      
      <!-- Cabe√ßalho do Laudo -->
      <header class="report-header">
        <div class="company-info">
          <h1>MEC√ÇNICA BORGES</h1>
          <p>Especialistas em Mec√¢nica Geral e Inje√ß√£o</p>
          <p class="small">Rua Exemplo, 123 - Centro - (11) 99999-9999</p>
        </div>
        <div class="report-meta">
          <div class="meta-box">
            <span>LAUDO T√âCNICO</span>
            <strong>#{{ currentReport()?.id }}</strong>
          </div>
          <p>Data: {{ currentReport()?.date }}</p>
        </div>
      </header>

      <hr class="divider">

      <!-- Dados do Cliente -->
      <section class="report-section">
        <h3>Dados do Ve√≠culo</h3>
        <div class="info-grid">
          <div>
            <label>Cliente:</label>
            <span>{{ currentReport()?.client }}</span>
          </div>
          <div>
            <label>Ve√≠culo:</label>
            <span>{{ currentReport()?.vehicle }}</span>
          </div>
          <div>
            <label>T√©cnico Resp.:</label>
            <span>{{ currentReport()?.technician }}</span>
          </div>
        </div>
      </section>

      <!-- Diagn√≥stico e Solu√ß√£o (Simulado) -->
      <section class="report-section content-box">
        <h3>Diagn√≥stico T√©cnico</h3>
        <p>
          O ve√≠culo apresentou ru√≠dos na suspens√£o dianteira e instabilidade em curvas.
          Ap√≥s an√°lise no elevador, constatou-se folga excessiva nas buchas de bandeja e 
          vazamento no amortecedor direito.
        </p>
        
        <h3>Servi√ßos Executados</h3>
        <p>
          Realizada a substitui√ß√£o do kit de amortecedores dianteiros, par de bandejas e 
          bieletas. Efetuado alinhamento 3D e balanceamento das rodas. 
          Teste de rodagem realizado com sucesso.
        </p>
      </section>

      <!-- Resumo Financeiro -->
      <section class="report-section financial">
        <table class="simple-table">
          <tr>
            <td>Servi√ßos / Pe√ßas</td>
            <td class="text-right">{{ currentReport()?.serviceType }}</td>
          </tr>
          <tr class="total-row">
            <td>TOTAL</td>
            <td class="text-right">{{ currentReport()?.total | currency:'BRL' }}</td>
          </tr>
        </table>
      </section>

      <!-- Rodap√© -->
      <footer class="report-footer">
        <p>Garantia de 90 dias para servi√ßos e pe√ßas.</p>
        <div class="signature-line">
          Assinatura do Respons√°vel
        </div>
      </footer>

      <!-- Bot√µes de A√ß√£o (N√£o saem na impress√£o) -->
      <div class="modal-actions no-print">
        <button class="btn-cancel" (click)="closeModal()">Fechar</button>
        <button class="btn-primary" (click)="printReport()">Imprimir PDF</button>
      </div>

    </div>
  </div>
}