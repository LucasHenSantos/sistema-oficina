<div class="page-container">
  
  <header class="page-header">
    <div>
      <h1>Controle de Estoque</h1>
      <p class="subtitle">Gerencie pe√ßas, quantidades e valores de venda</p>
    </div>
    <button class="btn-primary" (click)="openModal()">
      <span class="icon">üì¶</span> Novo Produto
    </button>
  </header>

  <div class="toolbar">
    <div class="search-box">
      <span class="search-icon">üîç</span>
      <input 
        type="text" 
        placeholder="Buscar por nome, c√≥digo ou marca..."
        [ngModel]="searchTerm()"
        (ngModelChange)="searchTerm.set($event)"
      >
    </div>
    
    <!-- Filtros R√°pidos (Visual apenas por enquanto) -->
    <div class="quick-filters">
      <span class="filter-chip alert">‚ö†Ô∏è Ver Estoque Baixo</span>
    </div>
  </div>

  <div class="table-container card">
    <table>
      <thead>
        <tr>
          <th>Produto / Marca</th>
          <th>Categoria</th>
          <th>Localiza√ß√£o</th>
          <th>Estoque</th>
          <th>Pre√ßos</th>
          <th class="actions-col">A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        @for (prod of filteredProducts(); track prod.id) {
          <tr>
            <!-- Info Principal -->
            <td>
              <div class="product-info">
                <div class="code-badge">{{ prod.code }}</div>
                <div class="text-data">
                  <strong>{{ prod.name }}</strong>
                  <span class="brand-text">{{ prod.brand }}</span>
                </div>
              </div>
            </td>
            
            <td><span class="cat-text">{{ prod.category }}</span></td>
            
            <td><span class="loc-text">üìç {{ prod.location }}</span></td>
            
            <!-- Estoque Colorido -->
            <td>
              <div class="stock-badge" [class]="getStockStatus(prod.quantity, prod.minQuantity)">
                <span class="qty">{{ prod.quantity }} un</span>
                <span class="status-dot"></span>
                <span class="status-label">{{ getStockLabel(prod.quantity, prod.minQuantity) }}</span>
              </div>
            </td>

            <!-- Pre√ßos -->
            <td>
              <div class="price-info">
                <span class="sell-price">{{ prod.sellPrice | currency:'BRL' }}</span>
                <span class="cost-price">Custo: {{ prod.costPrice | currency:'BRL' }}</span>
              </div>
            </td>

            <td class="actions-cell">
              <button class="btn-action edit" (click)="editProduct(prod)" title="Editar">‚úèÔ∏è</button>
              <button class="btn-action delete" (click)="deleteProduct(prod.id)" title="Excluir">üóëÔ∏è</button>
            </td>
          </tr>
        }
      </tbody>
    </table>

    @if (filteredProducts().length === 0) {
      <div class="empty-state">
        <p>Nenhum produto encontrado no estoque.</p>
      </div>
    }
  </div>

  <!-- MODAL DE CADASTRO -->
  @if (showModal()) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>{{ currentProduct().id === 0 ? 'Cadastrar Produto' : 'Editar Produto' }}</h2>
        
        <form (ngSubmit)="saveProduct()">
          
          <div class="form-row">
            <div class="form-group col-3">
              <label>C√≥digo (SKU)</label>
              <input type="text" [(ngModel)]="currentProduct().code" name="code" placeholder="Ex: OLE-001" required>
            </div>
            <div class="form-group col-9">
              <label>Nome do Produto</label>
              <input type="text" [(ngModel)]="currentProduct().name" name="name" placeholder="Ex: √ìleo 5W30" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-6">
              <label>Marca</label>
              <input type="text" [(ngModel)]="currentProduct().brand" name="brand" placeholder="Ex: Castrol">
            </div>
            <div class="form-group col-6">
              <label>Categoria</label>
              <select [(ngModel)]="currentProduct().category" name="category">
                @for (cat of categories(); track cat) {
                  <option [value]="cat">{{ cat }}</option>
                }
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-6">
              <label>Localiza√ß√£o (Prateleira)</label>
              <input type="text" [(ngModel)]="currentProduct().location" name="location" placeholder="Ex: A1">
            </div>
            <div class="form-group col-3">
              <label>Qtd. Atual</label>
              <input type="number" [(ngModel)]="currentProduct().quantity" name="qty" required>
            </div>
            <div class="form-group col-3">
              <label>M√≠nimo</label>
              <input type="number" [(ngModel)]="currentProduct().minQuantity" name="min" title="Avisa quando baixar disso">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-6">
              <label>Pre√ßo Custo (R$)</label>
              <input type="number" [(ngModel)]="currentProduct().costPrice" name="cost" step="0.01">
            </div>
            <div class="form-group col-6">
              <label>Pre√ßo Venda (R$)</label>
              <input type="number" [(ngModel)]="currentProduct().sellPrice" name="sell" step="0.01" required>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-cancel" (click)="closeModal()">Cancelar</button>
            <button type="submit" class="btn-save">Salvar Produto</button>
          </div>
        </form>
      </div>
    </div>
  }
</div>