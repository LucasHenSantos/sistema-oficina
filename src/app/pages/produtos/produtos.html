<div class="page-container">
    <header class="page-header">
        <h1>Produtos e Estoque</h1>
        <p class="subtitle">Gerencie pe√ßas, lubrificantes e itens de venda.</p>
        <button class="btn-primary" (click)="openModal()">
            <span class="icon">‚ûï</span> Novo Produto
        </button>
    </header>

    <div class="toolbar">
        <div class="search-box">
            <span class="search-icon">üîç</span>
            <input 
                type="text" 
                placeholder="Buscar por nome, c√≥digo ou marca..."
                [ngModel]="searchTerm()"
                (ngModelChange)="searchTerm.set($event)"
            >
        </div>
    </div>

    <div class="table-container card">
        <table>
            <thead>
                <tr>
                    <th>C√ìDIGO</th> 
                    <th>PRODUTO / MARCA</th>
                    <th>CATEGORIA</th>
                    <th>PRE√áO CUSTO</th>
                    <th>PRE√áO VENDA</th>
                    <th>ESTOQUE</th>
                    <th class="actions-col">A√á√ïES</th>
                </tr>
            </thead>
            <tbody>
                @for (product of filteredProducts(); track product.id) {
                    <tr>
                        <td>{{ product.code }}</td> 
                        <td>
                            <div class="product-info">
                                <strong>{{ product.name }}</strong>
                                <span class="detail-text">{{ product.brand }}</span>
                            </div>
                        </td>
                        <td>{{ product.category }}</td>
                        <td>{{ product.costPrice | currency:'BRL' }}</td>
                        <td class="sell-price">{{ product.sellPrice | currency:'BRL' }}</td>
                        <td>
                            <span class="stock-badge" [class]="getStockStatusClass(product.quantity, product.minQuantity)">
                                {{ getStockStatusText(product.quantity, product.minQuantity) }} ({{ product.quantity }})
                            </span>
                        </td>
                        <td class="actions-cell">
                            <button class="btn-action edit" (click)="editProduct(product)">‚úèÔ∏è</button>
                            <button class="btn-action delete" (click)="deleteProduct(product.id)">üóëÔ∏è</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    @if (showModal()) {
        <div class="modal-overlay" (click)="closeModal()">
            <div class="modal-content large-modal" (click)="$event.stopPropagation()">
                <h2>{{ currentProduct().id === 0 ? 'Novo Produto' : 'Editar Produto' }}</h2>
                
                <form (ngSubmit)="saveProduct()" #productForm="ngForm">
                    
                    <div class="form-section">
                        <h4>Dados B√°sicos</h4>
                        <div class="form-row">
                            <div class="form-group col-1">
                                <label>C√≥digo (Opcional)</label>
                                <input type="text" [(ngModel)]="currentProduct().code" name="code" placeholder="Ex: FIL-001">
                            </div>
                            <div class="form-group col-2">
                                <label>Nome do Produto *</label>
                                <input type="text" [(ngModel)]="currentProduct().name" name="name" required placeholder="Ex: Filtro de √ìleo 5w-30">
                            </div>
                            <div class="form-group col-1">
                                <label>Marca</label>
                                <input type="text" [(ngModel)]="currentProduct().brand" name="brand" placeholder="Ex: Shell">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-2">
                                <label>Localiza√ß√£o (Estoque)</label>
                                <input type="text" [(ngModel)]="currentProduct().location" name="location" placeholder="Ex: Prateleira A1">
                            </div>
                            <div class="form-group col-2">
                                <label>Categoria</label>
                                <select [(ngModel)]="currentProduct().category" name="category">
                                    @for (cat of categories(); track cat) {
                                        <option [value]="cat">{{ cat }}</option>
                                    }
                                    @if (categories().length === 0) {
                                        <option value="" disabled>Cadastre categorias em Configura√ß√µes</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4>Estoque e Pre√ßos</h4>
                        <div class="form-row">
                            <div class="form-group col-1">
                                <label>Quantidade Atual *</label>
                                <input type="number" [(ngModel)]="currentProduct().quantity" name="quantity" required min="0">
                            </div>
                            <div class="form-group col-1">
                                <label>Alerta M√≠nimo</label>
                                <input type="number" [(ngModel)]="currentProduct().minQuantity" name="minQuantity" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-1">
                                <label>Pre√ßo de Custo *</label>
                                <input type="number" [(ngModel)]="currentProduct().costPrice" name="costPrice" required min="0">
                            </div>
                            <div class="form-group col-1">
                                <label>Pre√ßo de Venda *</label>
                                <input type="number" [(ngModel)]="currentProduct().sellPrice" name="sellPrice" required min="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-cancel" (click)="closeModal()">Cancelar</button>
                        <button type="submit" class="btn-save" [disabled]="productForm.invalid">Salvar Produto</button>
                    </div>
                </form>
            </div>
        </div>
    }
</div>