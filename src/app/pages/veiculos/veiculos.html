<div class="page-container">
  
  <header class="page-header">
    <div>
      <h1>Ve√≠culos</h1>
      <p class="subtitle">Frota cadastrada e hist√≥rico de manuten√ß√µes</p>
    </div>
    <button class="btn-primary" (click)="openModal()">
      <span class="icon">+</span> Novo Ve√≠culo
    </button>
  </header>

  <div class="toolbar">
    <div class="search-box">
      <span class="search-icon">üîç</span>
      <input 
        type="text" 
        placeholder="Digite a placa, modelo ou nome do cliente..."
        [ngModel]="searchTerm()"
        (ngModelChange)="searchTerm.set($event)"
      >
    </div>
  </div>

  <div class="table-container card">
    <table>
      <thead>
        <tr>
          <th>Ve√≠culo</th>
          <th>Placa</th>
          <th>Propriet√°rio</th>
          <th>Status</th>
          <th class="actions-col">A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        @for (vehicle of filteredVehicles(); track vehicle.id) {
          <tr>
            <td>
              <div class="vehicle-info">
                <div class="brand-logo">{{ vehicle.brand.charAt(0) }}</div>
                <div class="text-data">
                  <strong>{{ vehicle.model }}</strong>
                  <span class="detail-text">{{ vehicle.brand }} ‚Ä¢ {{ vehicle.year }} ‚Ä¢ {{ vehicle.color }}</span>
                </div>
              </div>
            </td>
            <td>
              <div class="plate-badge">
                <div class="plate-header">BRASIL</div>
                <div class="plate-number">{{ vehicle.plate }}</div>
              </div>
            </td>
            <td>
              <div class="owner-link">üë§ {{ vehicle.client }}</div>
            </td>
            <td>
              @if (vehicle.status === 'in-shop') {
                <span class="status-tag in-shop">Na Oficina</span>
              } @else {
                <span class="status-tag delivered">Entregue</span>
              }
            </td>
            <td class="actions-cell">
              <button class="btn-action edit" (click)="editVehicle(vehicle)">‚úèÔ∏è</button>
              <button class="btn-action delete" (click)="deleteVehicle(vehicle.id)">üóëÔ∏è</button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- MODAL -->
  @if (showModal()) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>{{ currentVehicle().id === 0 ? 'Cadastrar Ve√≠culo' : 'Editar Ve√≠culo' }}</h2>
        
        <!-- #vehicleForm="ngForm" permite que o Angular monitore a validade deste formul√°rio -->
        <form (ngSubmit)="saveVehicle()" #vehicleForm="ngForm">
          
          <div class="form-row">
            <div class="form-group col-4">
              <label>Placa *</label>
              <!-- required e minlength for√ßam valida√ß√£o -->
              <input type="text" [(ngModel)]="currentVehicle().plate" name="plate" required minlength="7" placeholder="ABC-1234" style="text-transform: uppercase;">
            </div>
            <div class="form-group col-8">
              <label>Propriet√°rio *</label>
              <select [(ngModel)]="currentVehicle().client" name="client" required>
                <option value="" disabled selected>Selecione...</option>
                @for (owner of ownersList(); track owner) {
                  <option [value]="owner">{{ owner }}</option>
                }
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-6">
              <label>Marca</label>
              <input type="text" [(ngModel)]="currentVehicle().brand" name="brand" placeholder="Ex: Chevrolet">
            </div>
            <div class="form-group col-6">
              <label>Modelo *</label>
              <input type="text" [(ngModel)]="currentVehicle().model" name="model" required placeholder="Ex: Onix 1.0">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-4">
              <label>Ano</label>
              <input type="number" [(ngModel)]="currentVehicle().year" name="year">
            </div>
            <div class="form-group col-4">
              <label>Cor</label>
              <input type="text" [(ngModel)]="currentVehicle().color" name="color" placeholder="Ex: Prata">
            </div>
            
            <div class="form-group col-4">
              <label>Situa√ß√£o</label>
              <select [(ngModel)]="currentVehicle().status" name="status">
                <option value="in-shop">Na Oficina</option>
                <option value="delivered">Entregue</option>
              </select>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-cancel" (click)="closeModal()">Cancelar</button>
            <!-- O bot√£o ficar√° cinza e n√£o clic√°vel se o formul√°rio for inv√°lido -->
            <button type="submit" class="btn-save" [disabled]="vehicleForm.invalid">Salvar Ve√≠culo</button>
          </div>
        </form>
      </div>
    </div>
  }
</div>